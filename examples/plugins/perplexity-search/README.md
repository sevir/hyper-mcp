# Perplexity Search MCP Plugin

A Model Context Protocol (MCP) plugin that provides AI-powered search capabilities using Perplexity's Sonar models with real-time web search.

## Features

- AI-powered search using Perplexity's advanced models
- Real-time web search with automatic source attribution
- Multiple model options (sonar-pro, sonar-reasoning, sonar-deep-research)
- Citations and source transparency
- Configurable search parameters and response formatting
- Usage tracking and cost information

## Prerequisites

- A Perplexity API key from [Perplexity API Portal](https://www.perplexity.ai/settings/api)

## Installation

1. Ensure you have Rust installed (2024 edition recommended)
2. Clone the hyper-mcp repository
3. Navigate to the perplexity-search plugin directory:
   ```bash
   cd examples/plugins/perplexity-search
   ```
4. Build the plugin:
   ```bash
   cargo build --release
   ```

## Configuration

The plugin requires a Perplexity API key. You can obtain one from the [Perplexity API Portal](https://www.perplexity.ai/settings/api).

## Usage

### Tool: `perplexity_search`

Performs an AI-powered search using Perplexity's models with real-time web search capabilities.

#### Parameters

- `query` (required): The search query or question
- `api_key` (required): Your Perplexity API key
- `model` (optional): The model to use ("sonar-pro", "sonar-reasoning", "sonar-deep-research", default: "sonar-pro")
- `system_message` (optional): System message to set context for the AI
- `max_tokens` (optional): Maximum tokens in response (1-4096, default: 1000)
- `temperature` (optional): Controls randomness (0.0-2.0, default: 0.2)
- `search_recency_filter` (optional): Filter by recency ("month", "week", "day", "hour", default: "month")
- `return_citations` (optional): Include citations (default: true)
- `return_images` (optional): Include images in results (default: false)
- `return_related_questions` (optional): Include related questions (default: false)

#### Example Usage

```json
{
  "name": "perplexity_search",
  "arguments": {
    "query": "What are the latest developments in quantum computing?",
    "api_key": "your_perplexity_api_key_here",
    "model": "sonar-pro",
    "max_tokens": 1500,
    "return_citations": true
  }
}
```

#### Response Format

The tool returns formatted text containing:

1. **AI Response**: The main answer generated by the AI model
2. **Sources**: Citations and URLs used to generate the response
3. **Search Results**: Detailed search results with titles, URLs, snippets, and dates
4. **Usage Information**: Token usage and cost information

## Models

### sonar-pro
- **Description**: Lightweight, cost-effective search model with grounding
- **Best for**: General questions, quick answers, cost-effective searches
- **Speed**: Fast
- **Cost**: Low

### sonar-reasoning
- **Description**: Fast, real-time reasoning model for problem-solving
- **Best for**: Complex reasoning, step-by-step analysis, technical questions
- **Speed**: Fast
- **Cost**: Medium

### sonar-deep-research
- **Description**: Expert-level research model with comprehensive analysis
- **Best for**: In-depth research, detailed reports, academic topics
- **Speed**: Slower (more thorough)
- **Cost**: Higher

## API Documentation

This plugin uses Perplexity's Chat Completions API. For more details, see:
- [Perplexity API Documentation](https://docs.perplexity.ai/)
- [API Reference](https://docs.perplexity.ai/api-reference/chat-completions-post)
- [Quickstart Guide](https://docs.perplexity.ai/getting-started/quickstart)

## Response Features

### Citations
- Automatic source attribution
- Links to original sources
- Transparency in information sourcing

### Search Results
- Real-time web search integration
- Structured result format with metadata
- Date and recency information

### Usage Tracking
- Token consumption monitoring
- Cost calculation
- Request statistics

## Examples

### Basic Search
```json
{
  "query": "Explain machine learning basics",
  "api_key": "your_key_here"
}
```

### Advanced Research
```json
{
  "query": "Latest breakthroughs in CRISPR gene editing",
  "model": "sonar-deep-research",
  "max_tokens": 2000,
  "search_recency_filter": "week",
  "return_citations": true
}
```

### Technical Analysis
```json
{
  "query": "Compare Rust vs Go performance benchmarks",
  "model": "sonar-reasoning",
  "temperature": 0.1,
  "system_message": "You are a senior software engineer specializing in systems programming."
}
```

## Error Handling

The plugin handles various error scenarios:

- Invalid or missing API key
- Network connectivity issues
- API rate limiting
- Invalid parameters
- Malformed API responses

## Pricing

Perplexity API pricing varies by model:
- **sonar-pro**: Most cost-effective for general use
- **sonar-reasoning**: Moderate pricing for reasoning tasks
- **sonar-deep-research**: Higher cost for comprehensive research

Check the [Perplexity Pricing](https://docs.perplexity.ai/getting-started/pricing) page for current rates.

## Rate Limits

API usage is subject to rate limits based on your Perplexity plan. Monitor the usage information in responses to stay within limits.

## Development

### Building

```bash
cargo build
```

### Testing

```bash
cargo test
```

### Dependencies

- `extism-pdk`: Plugin development framework
- `serde`: JSON serialization/deserialization
- `serde_json`: JSON handling
- `urlencoding`: URL encoding for query parameters
- `chrono`: Date/time handling
- `base64-serde`: Base64 encoding support

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is licensed under the same license as the hyper-mcp project.